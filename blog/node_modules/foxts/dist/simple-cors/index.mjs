import{fastStringArrayJoin as e}from"../fast-string-array-join/index.mjs";function s(s){let t,r;const o={origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[],...s},n=o.origin;if("string"==typeof n)t="*"===n?()=>"*":e=>n===e?e:null;else if("function"==typeof n)t=n;else{const e=new Set(n);t=s=>e.has(s)?s:null}const a=o.allowMethods;r="function"==typeof a?a:Array.isArray(a)?()=>a:()=>[];const l="*"!==n;return async function(s,n){let a=t(s.headers.get("Origin")||"");if(a&&"object"==typeof a&&"then"in a&&(a=await a),a&&n.headers.set("Access-Control-Allow-Origin",a),l){const e=s.headers.get("Vary");e?n.headers.set("Vary",e):n.headers.set("Vary","Origin")}o.credentials&&n.headers.set("Access-Control-Allow-Credentials","true"),o.exposeHeaders?.length&&n.headers.set("Access-Control-Expose-Headers",e(o.exposeHeaders,","));let i=r(s.headers.get("origin")||"");if("then"in i&&(i=await i),i.length&&n.headers.set("Access-Control-Allow-Methods",e(i,",")),"OPTIONS"===s.method){null!=o.maxAge&&n.headers.set("Access-Control-Max-Age",o.maxAge.toString());let t=o.allowHeaders;if(!t?.length){const e=s.headers.get("Access-Control-Request-Headers");e&&(t=e.split(/\s*,\s*/))}t?.length&&(n.headers.set("Access-Control-Allow-Headers",e(t,",")),n.headers.append("Vary","Access-Control-Request-Headers"))}return n}}export{s as createSimpleCors};